<?php if(!isset($pdf_view)) : ?>
<div>
<h2>Statistics</h2>
<div class="subdiv">
	<?php echo $this->element("trapid_experiment");?>
	<h3>Transcript data</h3>
	<div class="subdiv">
		<dl class="standard extra">
			<dt>#Transcripts</dt>
			<dd><?php echo $num_transcripts; ?></dd>
			<dt>Average sequence length</dt>
			<dd><?php echo $seq_stats["transcript"];?></dd>
			<dt>Average ORF length</dt>
			<dd><?php echo $seq_stats["orf"];?></dd>
			<dt>#ORFs with a start codon</dt>
			<dd><?php echo $num_start_codons;?></dd>
			<dt>#ORFs with a stop codon</dt>
			<dd><?php echo $num_stop_codons;?></dd>
			<dt>#Transcripts with frameshift</dt>
			<dd><?php echo $num_correct_fs;?></dd>
			<dt>#Meta annotation full-length</dt>
			<dd><?php echo $meta_annot_fulllength;?></dd>
			<dt>#Meta annotation partial</dt>
			<dd><?php echo $meta_annot_partial;?></dd>
			<dt>#Meta annotation too long</dt>
			<dd><?php echo $meta_annot_toolong;?></dd>
		</dl>
	</div>

	<h3>Gene family data</h3>
	<div class="subdiv">
		<dl class="standard extra">
			<dt>#Gene families</dt>
			<dd><?php echo $num_gf;?></dd>
			<dt>#Transcripts in GF</dt>
			<dd><?php echo $num_transcript_gf." (".round(100*$num_transcript_gf/$num_transcripts,2)."%)";?></dd>
			<dt>Largest GF</dt>
			<dd><?php echo $html->link($biggest_gf['gf_id'],array("controller"=>"gene_family","action"=>"gene_family",$exp_id,$biggest_gf['gf_id']))." (".$biggest_gf['num_transcripts']." transcripts)";?></dd>
			<dt>#single copy</dt>
			<dd><?php echo $single_copy;?></dd>	
		</dl>
	</div>

	<h3>Functional data</h3>
	<div class="subdiv">
		<h4>Gene Ontology</h4>
		<dl class="standard extra">
			<dt>#GO terms</dt>
			<dd><?php echo $num_go;?></dd>
			<dt>#Transcripts with GO</dt>
			<dd><?php echo $num_transcript_go." (".round(100*$num_transcript_go/$num_transcripts,2)."%)";?></dd>
		</dl>
		<h4>InterPro</h4>
		<dl class="standard extra">
			<dt>#InterPro domains</dt>
			<dd><?php echo $num_interpro;?></dd>
			<dt>#Transcripts with InterPro</dt>
			<dd><?php echo $num_transcript_interpro." (".round(100*$num_transcript_interpro/$num_transcripts,2)."%)";?></dd>
		</dl>
	</div>

	<h3>Export</h3>
	<div class="subdiv">
		<br/>
		<?php
		echo $form->create("",array("url"=>array("controller"=>"tools","action"=>"statistics/".$exp_id),
				"type"=>"post"));		
		echo "<input type='hidden' name='export_type' value='pdf'/>\n";				
		echo "<input type='submit' value='PDF export' />\n";
		echo "</form>\n";
		?>	
	</div>	
</div>
</div>
<?php else: ?>
<?php
	$fpdf->setTitle("TRAPID analysis");
	$fpdf->AliasNbPages();
	$fpdf->AddPage();
	
	//ok, first display the standard information about the experiment.
	$fpdf->SetFont('Arial','U',12);
	$fpdf->Cell(60,10,"General TRAPID experiment information");
	$fpdf->Ln();
	$fpdf->SetFont("Arial","",10);
	$standard_info	= array("Title"=>"title","Description"=>"description","Creation date"=>"creation_date",
				"Last edit"=>"last_edit_date","Similarity search database"=>"used_blast_database",
				"Reference database"=>"used_plaza_database");
	foreach($standard_info as $k=>$v){
		$val	= $exp_info[$v];
		$fpdf->SetFont("","B");
		$fpdf->Cell(60,5,$k);
		$fpdf->SetFont("","");
		$fpdf->Cell(10);
		$fpdf->Cell(60,5,$val);	
		$fpdf->Ln();
	}
	$fpdf->Ln();
	$fpdf->Ln();
	
	//next, transcript counts
	$fpdf->SetFont('Arial','U',12);
	$fpdf->Cell(60,10,"Transcript information");
	$fpdf->Ln();
	$fpdf->SetFont("Arial","",10);
	foreach($transcript_counts as $k=>$v){
		$fpdf->SetFont("","B");
		$fpdf->Cell(60,5,$k);
		$fpdf->SetFont("","");
		$fpdf->Cell(10);
		$fpdf->Cell(60,5,$v);	
		$fpdf->Ln();		
	}
	$fpdf->Ln();
	$fpdf->Ln();
	
	//next, ORF counts
	$fpdf->SetFont('Arial','U',12);
	$fpdf->Cell(60,10,"Open Reading Frame (ORF) information");
	$fpdf->Ln();
	$fpdf->SetFont("Arial","",10);
	foreach($orf_counts as $k=>$v){
		$fpdf->SetFont("","B");
		$fpdf->Cell(60,5,$k);
		$fpdf->SetFont("","");
		$fpdf->Cell(10);
		$fpdf->Cell(60,5,$v);	
		$fpdf->Ln();		
	}
	$fpdf->Ln();
	$fpdf->Ln();

	echo $fpdf->fpdfOutput();    
?>
<?php endif; ?>