<?php if(isset($download_type)): ?>
<?php
//pr($transcript_data);
header("Content-disposition: attachment; filename=$file_name");
header("Content-type: text/plain");
if($download_type=="fasta_transcript"){
	foreach($transcript_data as $td){
		$t	= $td['Transcripts'];
		echo ">".$t['transcript_id']."\n";
		echo $t['transcript_sequence']."\n";
	}	
}
else if($download_type=="fasta_orf"){
	foreach($transcript_data as $td){
		$t	= $td['Transcripts'];	
		echo ">".$t['transcript_id']."\n";
		echo $t['orf_sequence']."\n";
	}		
}
else if($download_type=="table"){
	
}

?>
<?php else: ?>
<div>
<h2>Transcript subsets</h2>
<div class="subdiv">
	<?php echo $this->element("trapid_experiment");?>
	<h3>Parameters</h3>
	<div class="subdiv">
		<?php 
			//pr($parameters);
		?>
		<dl class="standard">
		<?php
		foreach($parameters as $key=>$values){
			echo "<dt>".$key."</dt>";
			echo "<dd>";
			echo "<div>";
			foreach($values as $value){
				if($key=="InterPro domain"){
					echo $html->link($value,array("controller"=>"functional_annotation","action"=>"interpro",$exp_id,$value));
				}
				else if($key=="Subset"){
					echo $html->link($value,array("controller"=>"labels","action"=>"view",$exp_id,$value));
				}
				else if($key=="GO label"){
					echo $html->link($value,array("controller"=>"functional_annotation","action"=>"go",$exp_id,str_replace(":","-",$value)));
				}
				else{
					echo "<span>".$value."</span>";
				}
				echo "<br/>";
			}	
			echo "</div>";	
			echo "</dd>";				
		}	
		//echo "<br/>";
		echo "<dt>#Transcripts</dt>";
		echo "<dd>";
		echo $paginator->params['paging']['TranscriptsPagination']['count'];	
		echo "</dd>";
		?>
		</dl>
	</div>

	<h3>Toolbox</h3>
	<div class="subdiv">
	<?php
		
		$toolbox= array("Data"=>array(
					array(
						"Create new subset",
						$html->url(array("controller"=>"trapid","action"=>"transcript_selection",implode("/",$this->passedArgs))),
						"some_image.png"
					),	
				));
		$this->set("toolbox",$toolbox);
		echo $this->element("toolbox");	
	?>
	</div>

	<h3>Transcripts</h3>
	<div class="subdiv">
		<?php echo $this->element("table_func");?>	
	</div>

</div>
</div>
<?php endif;?>