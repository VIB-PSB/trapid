<div>
<?php
//echo $javascript->link(array('prototype-1.7.0.0'));	
?>
<h2>Transcript</h2>
<div class="subdiv">
	<?php echo $this->element("trapid_experiment");?>	
	
	<h3>Structural transcript information</h3>
	<div class="subdiv">
			
		<dl class="standard2">

		<dt>Transcript identifier</dt>
		<dd><?php echo $transcript_info['transcript_id'];?></dd>

		<dt>Uploaded sequence</dt>
		<dd>
			<div>
			<?php 
			echo $form->create("",array("action"=>"transcript/".$exp_id."/".$transcript_info['transcript_id'],"type"=>"post"));
			?>
			<textarea cols="80" rows="5"  name="transcript_sequence"><?php echo $transcript_info['transcript_sequence'];?></textarea>
			<br/>			
			<input type="submit" value="Store changed uploaded sequence" />
			</form>
			</div>	
		</dd>

		<dt>Frameshift corrected sequence</dt>
		<dd>
			<div>
			<?php
			if($transcript_info['transcript_sequence_corrected']!=""){
				echo $form->create("",array("action"=>"transcript/".$exp_id."/".$transcript_info['transcript_id'],"type"=>"post"));
				echo "<textarea cols='80' rows='5'  name='corrected_sequence'>".$transcript_info['transcript_sequence_corrected']."</textarea>\n";
				echo "<br/>\n";
				echo "<input type='submit' value='Store changed corrected sequence' />\n";
				echo "</form>\n";		
			}
			else{
				echo "<span class='disabled'>Unavailable</span>\n";
			}
			?>
			</div>
		</dd>
	

		<dt>ORF sequence</dt>
		<dd>
			<div>
			<?php
			if($transcript_info['orf_sequence']!=""){
				echo $form->create("",array("action"=>"transcript/".$exp_id."/".$transcript_info['transcript_id'],"type"=>"post"));
				echo "<textarea cols='80' rows='5' name='orf_sequence'>".$transcript_info['orf_sequence']."</textarea>\n";
				echo "<br/>\n";
				echo "<input type='submit' value='Store changed ORF sequence' />\n";
				echo "<span style='margin-left:10px;'>".$html->link("Detect ORFs",array("controller"=>"trapid","action"=>"detect_orfs",$exp_id,$transcript_info['transcript_id']),array("target"=>"_blank"))."</span>\n";
				echo "</form>\n";
			}
			else{
				echo "<span class='disabled'>Unavailable</span>\n";	
			}		
			?>
			</div>
		</dd>	

		<dt>Detected frame</dt>
		<dd><?php echo $transcript_info['detected_frame'];?></dd>
		
		<dt>Detected strand</dt>
		<dd><?php echo $transcript_info['detected_strand'];?></dd>
		
		<dt>Start/stop codon</dt>
		<dd>
			<div>
			<?php
			if($transcript_info['orf_contains_start_codon']==1){
				echo "The ORF sequence <span style='color:green'>starts with a start codon</span>\n";
			}
			else{
				echo "The ORF sequence <span style='color:red'>does not start with a start codon</span>\n";
			}
			echo "<br/>\n";
			if($transcript_info['orf_contains_stop_codon']==1){
				echo "The ORF sequence <span style='color:green'>ends with a stop codon</span>\n";
			}
			else{
				echo "The ORF sequence <span style='color:red'>does not end with a stop codon</span>\n";
			}
			?>
			</div>
		</dd>	
		
		<?php
		if($transcript_info['putative_frameshift']==1){

		$is_corrected	= ($transcript_info['is_frame_corrected']==1);
		$style1		=  " style='color:orange' "; if($is_corrected){$style1= " style='color:blue' ";}
		echo "<dt>Frameshift</dt>\n";
		echo "<dd>";
		echo "<div style='padding-left:20px;'>";
		echo "<ul>";
		echo "<li $style1>A putative frameshift was detected in this sequence</li>";
		if($transcript_info['is_frame_corrected']==1){
			echo "<li style='color:green'>A putative frameshift was corrected with FrameDP</li>";
		}	
		echo "</ul>";
		echo "</div>";
		echo "</dd>\n";			
		}
		?>

		<dt>Meta annotation</dt>
		<dd>
			<div>			
			<?php
			$possible_meta	= array(	"No Information"=>array("color"=>"#D2D2D2"),
							"Partial"=>array("color"=>"#D23333"),
							"Full Length"=>array("color"=>"#000000")
					);				
			echo $form->create("",array("action"=>"transcript/".$exp_id."/".$transcript_info['transcript_id'],"type"=>"post"));
			echo "<span style='color:".$possible_meta[$transcript_info['meta_annotation']]['color']."'>";
			echo $transcript_info['meta_annotation'];
			echo "</span>\n";
			echo "<select name='meta_annotation' style='width:120px;margin-left:50px;'>";
			foreach($possible_meta as $pm=>$pm_data){
				$sel	= null;
				if($pm == $transcript_info['meta_annotation']){$sel=" selected='selected' ";}
				echo "<option value='".$pm."' $sel>".$pm."</option>";
			}
			echo "</select>\n";
			echo "<input type='submit' value='Store changed meta annotation' style='margin-left:20px;' />\n";
			echo "</form>\n";
			?>
			</div>
		</dd>
		
		<dt>Gene family</dt>
		<dd>
			<div>
			<?php
			if($transcript_info['gf_id']!=""){
				echo $html->link($transcript_info['gf_id'],array("controller"=>"gene_family","action"=>"gene_family",$exp_id,$transcript_info['gf_id']));
			}
			else{
				echo "<span class='disabled'>Unavailable</span>\n";
			}			
			?>
			<?php if($exp_info['genefamily_type']=="HOM"): ?>					
			<span style='margin-left:5px;'>
			<?php
				echo "(".$html->link("change gene family",array("controller"=>"trapid","action"=>"similarity_hits",$exp_id,$transcript_info['transcript_id'])).")";
			?>
			</span>	
			<?php endif;?>
			</div>
		</dd>	
		</dl>
	</div>
	<br/><br/>
	<h3>Toolbox</h3>
	<div class="subdiv">
	<?php
	$disabled_framedp	= true;
	if($transcript_info['gf_id']){$disabled_framedp=false;}	
	$toolbox	= array("Structural data"=>array(
					array(
					"Correct frameshifts with FrameDP",
					$html->url(array("controller"=>"tools","action"=>"framedp",$exp_id,$transcript_info['gf_id'],$transcript_info['transcript_id'])),
					"some_image.png",
					$disabled_framedp				
					),
				)
			);
	$this->set("toolbox",$toolbox);
	echo $this->element("toolbox");	
	?>		
	</div>

	<br/><br/>
	<h3>Functional transcript information</h3>
	<div class="subdiv">
		<dl class="standard2">
		
		<dt>Gene Ontology</dt>
		<dd>			
			<?php
			if($associated_go){
			        echo "<ul class='tabbed_header'>\n";
				echo "<li id='tab_collapsed' class='selected_tab'>";
				echo "<a href=\"javascript:switch_go_display('tab_collapsed','div_collapsed');\">Collapsed GO data</a>";
				echo "</li>\n";								
				echo "<li id='tab_all'>";
				echo "<a href=\"javascript:switch_go_display('tab_all','div_all');\">All GO data</a>";
				echo "</li>\n";
				echo "</ul>\n";
				
				echo "<div class='tabbed_div selected_tabbed_div' id='div_collapsed'>\n";
				echo "<table class='small' cellpadding='0' cellspacing='0' style='width:600px;'>\n";
				echo "<tr><th style='width:20%;'>GO term</th><th style='width:80%;'>Description</th></tr>\n";
				foreach($associated_go as $ag){
					$go		= $ag['TranscriptsGo']['go'];
					$is_hidden	= $ag['TranscriptsGo']['is_hidden'];
					if($is_hidden==0){	
					    $web_go		= str_replace(":","-",$go);
					    echo "<tr>";
					    echo "<td>".$html->link($go,array("controller"=>"functional_annotation","action"=>"go",$exp_id,$web_go))."</td>";
					    echo "<td>".$go_info[$go]['desc']."</td>";
					    echo "</tr>\n";
					}
				}
				echo "</table>\n";
				echo "</div>\n";
					
				echo "<div class='tabbed_div' id='div_all'>\n";
				echo "<table class='small' cellpadding='0' cellspacing='0' style='width:600px;'>\n";
				echo "<tr><th style='width:20%;'>GO term</th><th style='width:80%;'>Description</th></tr>\n";
				foreach($associated_go as $ag){
					$go		= $ag['TranscriptsGo']['go'];
					$web_go		= str_replace(":","-",$go);
					$is_hidden	= $ag['TranscriptsGo']['is_hidden'];
					$class		= null;
					if($is_hidden==0){$class=" class='altrow' ";}	
					echo "<tr $class >";
					echo "<td>".$html->link($go,array("controller"=>"functional_annotation","action"=>"go",$exp_id,$web_go))."</td>";
					echo "<td>".$go_info[$go]['desc']."</td>";
					echo "</tr>\n";
				}
				echo "</table>\n";
				echo "</div>\n";		
			}
			else{
				echo "<span class='disabled'>Unavailable</span>";
			}
			?>						
		</dd>

		<dt>Interpro domains</dt>
		<dd>
			<?php
			if($associated_interpro){
				echo "<table class='small' cellpadding='0' cellspacing='0' style='width:600px;'>\n";
				echo "<tr><th style='width:20%;'>InterPro domain</th><th style='width:80%;'>Description</th></tr>\n";
				foreach($associated_interpro as $ai){
					$ipr	= $ai['TranscriptsInterpro']['interpro'];
					echo "<tr>";
					echo "<td>".$html->link($ipr,array("controller"=>"functional_annotation","action"=>"interpro",$exp_id,$ipr))."</td>";	
					echo "<td>".$interpro_info[$ipr]['desc']."</td>";
					echo "</tr>\n";
				}
				echo "</table>\n";
			}
			else{
				echo "<span class='disabled'>Unavailable</span>";
			}
			?>		
		</dd>
					
		</dl>
	</div>
	<script type="text/javascript">
	//<![CDATA[
		function switch_go_display(tab_id,div_id){
			//make all tabs and divs 'normal'
			$("tab_collapsed").className="";
			$("tab_all").className="";
			$("div_collapsed").className="tabbed_div";
			$("div_all").className="tabbed_div";
			//create extra class for the correct tab and div
			$(tab_id).className="selected_tab";
			$(div_id).className="tabbed_div selected_tabbed_div";	
		}
	//]]>
	</script>
	
</div>
</div>