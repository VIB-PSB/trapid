var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,c,a){b!=Array.prototype&&b!=Object.prototype&&(b[c]=a.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var c=0;return $jscomp.iteratorPrototype(function(){return c<b.length?{done:!1,value:b[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.iteratorFromArray=function(b,c){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var a=0,d={next:function(){if(a<b.length){var e=a++;return{value:c(e,b[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(b,c,a,d){if(c){a=$jscomp.global;b=b.split(".");for(d=0;d<b.length-1;d++){var e=b[d];e in a||(a[e]={});a=a[e]}b=b[b.length-1];d=a[b];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
var DirectedAcyclicGraphContextMenu=function(b,c){var a=ContextMenu().on("open",function(a){e.open.call(this,a)}).on("close",function(a){e.close.call(this,a)}).on("click",function(a){if("hideselected"==a.operation){var d=c.selectAll(".node.selected").data(),f="User Selection";e.hidenodes.call(this,d,f)}"hideunselected"==a.operation&&(d=c.selectAll(".node").filter(function(a){return!d3.select(this).classed("selected")}).data(),f="User Selection",e.hidenodes.call(this,d,f));"hidethis"==a.operation&&
(d=d3.select(this).data(),f="User Selection",e.hidenodes.call(this,d,f));if("hidefield"==a.operation){var k=a.fieldname,n=a.value;d=b.getNodes().filter(function(a){return!a.never_visible&&a.report&&a.report[k]&&a.report[k][0]==n});f=k+": "+n;e.hidenodes.call(this,d,f)}"invertselection"==a.operation&&(d=c.selectAll(".node").filter(function(a){return!d3.select(this).classed("selected")}).data(),e.selectnodes.call(this,d));"selectall"==a.operation&&(d=b.getVisibleNodes(),e.selectnodes.call(this,d));
if("selectneighbours"==a.operation){var p=d3.select(this).data()[0];d=p.getVisibleParents().concat(p.getVisibleChildren());d.push(p);e.selectnodes.call(this,d)}"selectpath"==a.operation&&(d=getEntirePathNodes(d3.select(this).data()[0]),e.selectnodes.call(this,d,f));"selectfield"==a.operation&&(k=a.fieldname,n=a.value,d=b.getVisibleNodes().filter(function(a){return a.report&&a.report[k]&&a.report[k][0]==n}),e.selectnodes.call(this,d))}).on("mouseover",function(a){var d=[];"hideselected"==a.operation&&
(d=c.selectAll(".node.selected").data());"hideunselected"==a.operation&&(d=c.selectAll(".node").filter(function(a){return!d3.select(this).classed("selected")}).data());"hidethis"==a.operation&&(d=d3.select(this).data());if("hidefield"==a.operation||"selectfield"==a.operation){var f=a.fieldname,k=a.value;d=b.getVisibleNodes().filter(function(a){return a.report&&a.report[f]&&a.report[f][0]==k})}"invertselection"==a.operation&&(d=c.selectAll(".node").filter(function(a){return!d3.select(this).classed("selected")}).data());
"selectall"==a.operation&&(d=b.getVisibleNodes());if("selectneighbours"==a.operation){var n=d3.select(this).data()[0];d=n.getVisibleParents().concat(n.getVisibleChildren());d.push(n)}"selectpath"==a.operation&&(d=getEntirePathNodes(d3.select(this).data()[0]));e.hovernodes.call(this,d)}).on("mouseout",function(a){e.hovernodes.call(this,[])}),d=function(b){d.hide.call(this,b);b.each(function(c){var d=[];d.push({operation:"hidethis",name:"Hide this node"});b.filter(".selected").empty()||(d.push({operation:"hideselected",
name:"Hide selected nodes"}),d.push({operation:"hideunselected",name:"Hide non-selected nodes"}));var e=function(a){c.report&&c.report[a]&&c.report[a][0]&&d.push({operation:"hidefield",name:"Hide all \x3cspan class\x3d'highlight'\x3e"+c.report[a][0]+"\x3c/span\x3e nodes",fieldname:a,value:c.report[a][0]})},f=function(a){c.report&&c.report[a]&&c.report[a][0]&&d.push({operation:"selectfield",name:"Select all \x3cspan class\x3d'highlight'\x3e"+c.report[a][0]+"\x3c/span\x3e nodes",fieldname:a,value:c.report[a][0]})};
e("Agent");e("Host");e("Class");e("ProcessID");e("StateMachineID");b.filter(".selected").empty()||d.push({operation:"invertselection",name:"Invert selection"});d.push({operation:"selectall",name:"Select all"});d.push({operation:"selectneighbours",name:"Select neighbours"});d.push({operation:"selectpath",name:"Select path"});f("Agent");f("Host");f("Class");f("ProcessID");f("StateMachineID");a.call(this,d);d3.select(this).classed("hascontextmenu",!0)})};d.hide=function(a){d3.select(this).selectAll(".hascontextmenu").each(function(a){$(this).unbind("contextmenu")});
d3.select(this).selectAll(".context-menu").remove()};var e={hidenodes:function(){},selectnodes:function(){},hovernodes:function(){},open:function(){},close:function(){}};d.on=function(a,b){if(!e.hasOwnProperty(a))return d;if(1==arguments.length)return e[a];e[a]=b;return d};return d},CompareGraphContextMenu=function(){var b=ContextMenu().on("click",function(b){"viewthis"==b.operation&&a.view.call(this,d3.select(this).datum());"removeselected"==b.operation&&a.hide.call(this,d3.selectAll(".node.selected").data());
"clusterselected"==b.operation&&a.hide.call(this,d3.selectAll(".node").filter(function(a){return!d3.select(this).classed("selected")}).data());"compareselected"==b.operation&&a.compare.call(this,d3.selectAll(".node.selected").data());"comparetoselected"==b.operation&&(b=d3.selectAll(".node.selected").data().concat(d3.select(this).data()),a.compare.call(this,b))}).on("open",function(b){a.open.call(this,b)}),c=function(a){c.hide.call(this,a);a.each(function(c){c=[];c.push({operation:"viewthis",name:"View execution graph"});
var d=a.filter(".selected");!d.empty()&&1<a[0].length-d[0].length&&c.push({operation:"removeselected",name:"Remove selected from the clustering"});1<d[0].length&&c.push({operation:"clusterselected",name:"Re-cluster using selected"});2==d[0].length&&c.push({operation:"compareselected",name:"Compare graphs of selected"});1==d[0].length&&d.datum()!=d3.select(this).datum()&&c.push({operation:"comparetoselected",name:"Compare graph of this to selected"});b.call(this,c);d3.select(this).classed("hascontextmenu",
!0)})};c.hide=function(a){d3.select(this).selectAll(".hascontextmenu").each(function(a){$(this).unbind("contextmenu")});d3.select(this).selectAll(".context-menu").remove()};var a={open:function(){},view:function(){},hide:function(){},compare:function(){}};c.on=function(b,e){if(!a.hasOwnProperty(b))return c;if(1==arguments.length)return a[b];a[b]=e;return c};return c},ContextMenu=function(){var b=0,c=function(c){for(var k=this,m={},p=0;p<c.length;p++){var q=c[p],l=f.call(this,q);m[l]={click:a(k,q,
p),mouseover:d(k,q,p),mouseout:e(k,q,p)}}$(k).contextMenu("context-menu"+b++,m,{disable_native_context_menu:!0,showMenu:function(){g.open.call(k,c)},hideMenu:function(){g.close.call(k,c)}})},a=function(a,b,c){return function(){g.click.call(a,b,c)}},d=function(a,b,c){return function(){g.mouseover.call(a,b,c)}},e=function(a,b,c){return function(){g.mouseout.call(a,b,c)}},f=function(a){return a.name},g={click:function(){},open:function(){},close:function(){},mouseover:function(){},mouseout:function(){}};
c.name=function(a){if(0==arguments.length)return f;f=a;return c};c.on=function(a,b){if(!g[a])return c;if(1==arguments.length)return g[a];g[a]=b;return c};return c};
function DirectedAcyclicGraph(b,c){function a(b){b.each(function(b){var d=d3.select(this).selectAll("svg").data([b]);d.enter().append("svg").append("g").attr("class","graph").classed("animate",e);d.attr("width",f.call(this,b));d.attr("height",g.call(this,b));var D=q.call(this,b);b=p.call(this,b);var l=d.select(".graph").selectAll(".edge").data(D,m),n=d.select(".graph").selectAll(".node").data(b,k),u=l.exit(),J=n.exit(),I=l.enter().insert("path",":first-child").attr("class","edge entering"),G=n.enter().append("g").attr("class",
"node entering");G.each(r);n.each(C);J.each(y);e?u.classed("visible",!1).transition().duration(c.animationDuration).remove():u.classed("visible",!1).remove();n.classed("pre-existing",!0);x.call(d.select(".graph").node(),b,D);n.classed("pre-existing",!1);e?(d.select(".graph").selectAll(".edge.visible").transition().duration(c.animationDuration).attrTween("d",a.edgeTween),n.transition().duration(c.animationDuration).attr("transform",a.nodeTranslate)):(d.select(".graph").selectAll(".edge.visible").attr("d",
a.splineGenerator),n.attr("transform",a.nodeTranslate));G.each(v);I.attr("d",a.splineGenerator).classed("visible",!0);n.classed("visible",!0);window.setTimeout(function(){I.classed("entering",!1);G.classed("entering",!1)},2E3)})}var d=0,e=!0,f=constant("100%"),g=constant("100%"),m=function(a){return a.source.id+a.target.id},k=function(a){return a.id},n=function(a){return a.details.name?a.details.name.replace(/_/," "):""},p=function(a){return a.getVisibleNodes()},q=function(a){return a.getVisibleLinks()},
l=function(a){return d3.select(this).select("rect").node().getBBox()},r=function(b){d3.select(this).append("rect");var d=c.nodeSize(b.details);if(1==b.details.is_root){var e=d3.svg.arc().innerRadius(0).outerRadius(Math.sqrt(2)*d/2).startAngle(Math.PI/180*0).endAngle(Math.PI/180*360);d3.select(this).append("path").attr("d",e).attr("class","root")}else{e=d3.svg.arc().innerRadius(0).outerRadius(Math.sqrt(2)*d/2-c.donutGraphOuterWidth/2).startAngle(Math.PI/180*0).endAngle(Math.PI/180*360);var f=d3.svg.arc().innerRadius(Math.sqrt(2)*
d/2-c.donutGraphOuterWidth).outerRadius(Math.sqrt(2)*d/2).startAngle(Math.PI/180*0).endAngle(Math.PI/180*360*c.donutGraphValue(b.details));d=d3.svg.arc().innerRadius(Math.sqrt(2)*d/2-(c.donutGraphOuterWidth+c.donutGraphInnerWidth)/2).outerRadius(Math.sqrt(2)*d/2-(c.donutGraphOuterWidth-c.donutGraphInnerWidth)/2).startAngle(Math.PI/180*360*c.donutGraphValue(b.details)).endAngle(Math.PI/180*360);d3.select(this).append("path").attr("class","fill").attr("d",e).style("fill",c.nodeColorScale(c.nodeValue(b.details)));
d3.select(this).append("path").attr("class","donutValue").attr("d",f).style("fill",c.donutGraphColorScale(1));d3.select(this).append("path").attr("class","donutFill").attr("d",d).style("fill",c.donutGraphColorScale(0));d3.select(this).style("opacity",c.nodeOpacity(b.details))}e=d3.select(this).append("text").attr("text-anchor","middle").attr("x",0);c.linkUrl?e.append("a").attr("href",c.linkUrl+k(b)).attr("target",c.linkTarget).append("tspan").attr("x",0).attr("dy","1em").text(k):e.append("tspan").attr("x",
0).attr("dy","1em").text(k);f=n(b).split(" ");for(token in f)e.append("tspan").attr("x",0).attr("dy","1.1em").text(f[token]);null!=t.call(this,b)&&d3.select(this).attr("transform",a.nodeTranslate)},C=function(a){a=c.nodeSize(a.details);var b=d3.select(this).select("rect"),d=d3.select(this).select("text");b.attr("x",-a/2).attr("y",-a/2);b.attr("width",a).attr("height",a);d.attr("x",-a/2);"middle"==c.nodeLabelPosition?d.attr("y",-a/2):"bottom"==c.nodeLabelPosition&&d.attr("y",(a+10)/2);d.style("dominant-baseline",
"text-before-edge")},y=function(a){e?d3.select(this).classed("visible",!1).transition().duration(c.animationDuration).remove():d3.select(this).classed("visible",!1).remove()},v=function(b){d3.select(this).classed("visible",!0).attr("transform",a.nodeTranslate)},x=function(a,b){var e=(new Date).getTime();d3.select(this).selectAll(".node").each(function(a){a.bbox=l.call(this,a);a.width=a.bbox.width;a.height=a.bbox.height;a.dagre_prev=a.dagre_id==d?a.dagre:null;a.dagre_id=d+1});d++;console.log("layout:bbox",
(new Date).getTime()-e);e=(new Date).getTime();dagre.layout().nodeSep(c.nodeSeparation).edgeSep(c.edgeSeparation).rankSep(c.levelSeparation).nodes(a).edges(b).run();console.log("layout:dagre",(new Date).getTime()-e);d3.select(this).selectAll(".edge").each(function(a){var b=a.dagre.points;b.push(dagre.util.intersectRect(a.target.dagre,0<b.length?b[b.length-1]:a.source.dagre));b.splice(0,0,dagre.util.intersectRect(a.source.dagre,b[0]));b[0].y-=.5;b[b.length-1].y+=.5});var f=0,g=0,k=0;d3.select(this).selectAll(".node.pre-existing").each(function(a){a.dagre_prev&&
(f++,g+=a.dagre_prev.x-a.dagre.x,k+=a.dagre_prev.y-a.dagre.y)});0<f&&(g/=f,k/=f,d3.select(this).selectAll(".node").each(function(a){a.dagre.x+=g;a.dagre.y+=k}),d3.select(this).selectAll(".edge").each(function(a){a.dagre.points.forEach(function(a){a.x+=g;a.y+=k})}))},t=function(a){return a.dagre},z=function(a){return a.dagre.points};a.splineGenerator=function(a){return d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("basis")(z.call(this,a))};a.edgeTween=function(b){b=
a.splineGenerator.call(this,b);var c=this,d=c.cloneNode(),e=c.getTotalLength(),f=(d.setAttribute("d",b),d).getTotalLength();b=[0];for(var l=0,g=Math.max(1/8,4/Math.max(e,f));1>(l+=g);)b.push(l);b.push(1);var k=b.map(function(a){var b=c.getPointAtLength(a*e);a=d.getPointAtLength(a*f);return d3.interpolate([b.x,b.y],[a.x,a.y])}),n=d3.svg.line().interpolate("basis");return function(a){return n(k.map(function(b){return b(a)}))}};a.nodeTranslate=function(a){a=t.call(this,a);return"translate("+a.x+","+
a.y+")"};a.width=function(b){if(!arguments.length)return f;f=d3.functor(b);return a};a.height=function(b){if(!arguments.length)return g;g=d3.functor(b);return a};a.edgeid=function(b){if(!arguments.length)return m;m=b;return a};a.nodeid=function(b){if(!arguments.length)return k;k=b;return a};a.nodename=function(b){if(!arguments.length)return n;n=b;return a};a.nodes=function(b){if(!arguments.length)return p;p=d3.functor(b);return a};a.edges=function(b){if(!arguments.length)return q;q=d3.functor(b);
return a};a.bbox=function(b){if(!arguments.length)return l;l=d3.functor(b);return a};a.drawnode=function(b){if(!arguments.length)return r;r=b;return a};a.removenode=function(b){if(!arguments.length)return y;y=b;return a};a.newnodetransition=function(b){if(!arguments.length)return v;v=b;return a};a.layout=function(b){if(!arguments.length)return x;x=b;return a};a.nodepos=function(b){if(!arguments.length)return t;t=b;return a};a.edgepos=function(b){if(!arguments.length)return z;z=b;return a};a.animate=
function(b){if(!arguments.length)return e;e=b;return a};return a}
function EnricherGo(b,c,a){function d(){E.call(l.node(),l.selectAll(".node"));E.on("open",function(){B.hide()}).on("close",function(){p||(l.selectAll(".node").classed("preview",!1),l.selectAll(".edge").classed("preview",!1))}).on("hidenodes",function(a){var b=[],c;for(c in a)b.push(a[c].details.id);a=v.addSelection(a,b);p||l.classed("hovering",!1);C.datum(v).call(A);a=A.bbox().call(A.select.call(C.node(),a),a);var d=u.getTransform(a);t.removenode(function(a){p?d3.select(this).remove():d3.select(this).classed("visible",
!1).transition().duration(800).attr("transform",d).remove()});n.draw();var e={};l.selectAll(".node.selected").data().forEach(function(a){e[a.id]=!0});l.selectAll(".edge").classed("selected",function(a){return e[a.source.id]&&e[a.target.id]})}).on("hovernodes",function(a){if(!p){l.selectAll(".node").classed("preview",function(b){return-1!=a.indexOf(b)});var b={};l.selectAll(".node.preview").data().forEach(function(a){b[a.id]=!0});l.selectAll(".edge").classed("preview",function(a){return b[a.source.id]&&
b[a.target.id]})}}).on("selectnodes",function(a){var b={};a.forEach(function(a){b[a.id]=!0});l.selectAll(".node").classed("selected",function(a){a=b[a.id];d3.event.ctrlKey&&(a=a||d3.select(this).classed("selected"));return a});l.selectAll(".edge").classed("selected",function(a){a=b[a.source.id]&&b[a.target.id];d3.event.ctrlKey&&(a=a||d3.select(this).classed("selected"));return a});d();B.hide()})}function e(){function a(a){var d={},e={};getEntirePathLinks(a).forEach(function(a){d[a.source.id]=!0;d[a.target.id]=
!0;e[a.source.id+a.target.id]=!0});c.classed("hovered",function(a){return e[a.source.id+a.target.id]});b.classed("hovered",function(a){return d[a.id]});var f={},l={};f[a.id]=!0;a.getVisibleParents().forEach(function(b){f[b.id]=!0;l[b.id+a.id]=!0});a.getVisibleChildren().forEach(function(b){f[b.id]=!0;l[a.id+b.id]=!0});c.classed("immediate",function(a){return l[a.source.id+a.target.id]});b.classed("immediate",function(a){return f[a.id]})}var b=l.selectAll(".node"),c=l.selectAll(".edge"),e=C.selectAll(".item");
Selectable().getrange(function(a,c){a=getNodesBetween(a,c).concat(getNodesBetween(c,a));return b.data(a,t.nodeid())}).on("select",function(){var a={};l.selectAll(".node.selected").data().forEach(function(b){a[b.id]=!0});c.classed("selected",function(b){return a[b.source.id]&&a[b.target.id]});d();B.hide()})(b);if(!p)b.on("mouseover",function(b){l.classed("hovering",!0);a(b)}).on("mouseout",function(a){l.classed("hovering",!1);c.classed("hovered",!1).classed("immediate",!1);b.classed("hovered",!1).classed("immediate",
!1)});e.on("click",function(a,b){v.remove(a);C.datum(v).call(A);var c=u.getTransform(A.bbox().call(this,a));t.newnodetransition(function(a){t.animate()?d3.select(this).attr("transform",c).transition().duration(800).attr("transform",t.nodeTranslate):d3.select(this).attr("transform",c).attr("transform",t.nodeTranslate)});n.draw()})}function f(a,b){d3.select(a).attr("width",1920).attr("height",1080).selectAll("text").attr("opacity",1);d3.xhr("dist/enricher.css",function(c){d3.select(a).insert("defs",
":first-child").append("style").attr("type","text/css").text(c.responseText);b()})}function g(a,b){var c=new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}),d=document.createElement("a");d.setAttribute("download",b);d.setAttribute("href",a);d.setAttribute("target","_blank");d.dispatchEvent(c)}function m(b){a.onLoadingStart();var c=new XMLSerializer,d=l.select("svg").node().cloneNode(!0);f(d,function(){var e=c.serializeToString(d);e="data:image/svg+xml;charset\x3dutf-8,"+encodeURIComponent('\x3c?xml version\x3d"1.0" standalone\x3d"no"?\x3e\r\n'+
e);g(e,b);a.onLoadingStop()})}function k(b){a.onLoadingStart();var c=new XMLSerializer,d=l.select("svg").node().cloneNode(!0);f(d,function(){var e=c.serializeToString(d);e="data:image/svg+xml;charset\x3dutf-8,"+encodeURIComponent('\x3c?xml version\x3d"1.0" standalone\x3d"no"?\x3e\r\n'+e);var f=l.node().getBBox(),k=document.createElement("canvas");k.width=1920;k.height=1080;var n=k.getContext("2d");n.clearRect(0,0,f.width,f.height);var m=new Image;m.onload=function(){n.drawImage(m,0,0);var c=k.toDataURL("image/png").replace("image/png",
"image/octet-stream");g(c,b);document.removeChild(k);a.onLoadingStop()};m.src=e})}a=a||{};a.width=a.width||"100%";a.height=a.height||"100%";if((typeof a.animationEnabled)=="undefined"){a.animationEnabled=true;};a.animationDuration=a.animationDuration||800;a.levelSeparation=a.levelSeparation||500;a.edgeSeparation=a.edgeSeparation||5;a.nodeSeparation=a.nodeSeparation||75;a.namespace=a.namespace||void 0;a.nodeSize=a.nodeSize||function(a){return 100};a.nodeColorScale=a.nodeColorScale||d3.interpolateRdYlGn;a.nodeOpacity=a.nodeOpacity||
function(a){return 1};a.nodeValue=a.nodeValue||function(a){return 1};a.nodeLabelPosition=a.nodeLabelPosition||"bottom";a.donutGraphOuterWidth=a.donutGraphOuterWidth||20;a.donutGraphInnerWidth=a.donutGraphInnerWidth||10;a.donutGraphColorScale=a.donutGraphColorScale||d3.interpolateRdYlGn;a.donutGraphValue=a.donutGraphValue||function(a){return 1};a.sidebarWidth=a.sidebarWidth||"20%";if((typeof a.sidebarMiniMapShow)=="undefined"){a.sidebarMiniMapShow=true;}a.sidebarMiniMapHeight=a.sidebarMiniMapHeight||"20%";a.export=a.export||
{};a.export.png=a.export.png||void 0;a.export.svg=a.export.svg||void 0;a.export.json=a.export.json||void 0;a.link=a.link||void 0;a.linkTarget=a.linkTarget||"_self";a.tooltipGravity=a.tooltipGravity||$.fn.tipsy.autoWE;a.tooltipFields=a.tooltipFields||{};a.onLoadingStart=a.onLoadingStart||function(){};a.onLoadingStop=a.onLoadingStop||function(){};var n=this,p=!a.animationEnabled,q=d3.select(b).append("svg").attr("width",a.width).attr("height",a.height),l=q.append("svg").attr("width","100%").attr("height",
"100%").attr("class","graph-attach");l.node().oncontextmenu=function(a){return!1};var r=q.append("svg").attr("class","minimap-attach"),C=q.append("svg").attr("class","history-attach"),y=createGraphFromJSON(c,a),v=DirectedAcyclicGraphHistory(),x=d3.select(b).node().getBoundingClientRect(),t=DirectedAcyclicGraph(b,a).animate(!p),z=0,D=0;z=-1!=a.sidebarWidth.indexOf("%")?100-parseFloat(a.sidebarWidth)+"%":x.width-a.sidebarWidth;D=-1!=a.sidebarMiniMapHeight.indexOf("%")?100-parseFloat(a.sidebarMiniMapHeight)+
"%":x.height-a.sidebarMiniMapHeight;if(a.sidebarMiniMapShow)var H=DirectedAcyclicGraphMinimap(t,a).width(a.sidebarWidth).height(a.sidebarMiniMapHeight).x(z).y(D);var A=List(a).width(a.sidebarWidth).height(a.sidebarMiniMapShow?x.height-a.sidebarMiniMapHeight:x.height).x(z).y(0),B=DirectedAcyclicGraphTooltip(a),E=DirectedAcyclicGraphContextMenu(y,l),F=function(){var a=u.translate(),c=u.scale();l.select(".graph").attr("transform","translate("+a[0]+","+a[1]+") scale("+c+")");r.select(".viewfinder").attr("x",
-a[0]/c).attr("y",-a[1]/c).attr("width",b.offsetWidth/c).attr("height",b.offsetHeight/c);p||l.selectAll(".node text").attr("opacity",3*c-.3)},u=MinimapZoom().scaleExtent([.001,2]).on("zoom",F);u.call(this,q,r);q=function(){var a=l.node().getBBox(),c=a.x,d=a.y,e=a.width+50;a=a.height+50;scale=Math.min(b.offsetWidth/e,b.offsetHeight/a);w=b.offsetWidth/scale;h=b.offsetHeight/scale;tx=((w-e)/2-c+25)*scale;ty=((h-a)/2-d+25)*scale;u.translate([tx,ty]).scale(scale);F()};this.draw=function(){a.onLoadingStart();
B.hide();console.log("draw begin");var b=(new Date).getTime(),c=(new Date).getTime();l.datum(y).call(t);console.log("draw graph",(new Date).getTime()-c);a.sidebarMiniMapShow&&(c=(new Date).getTime(),r.datum(l.node()).call(H),console.log("draw minimap",(new Date).getTime()-c));c=(new Date).getTime();l.selectAll(".node").call(B);console.log("draw tooltips",(new Date).getTime()-c);c=(new Date).getTime();e();console.log("draw events",(new Date).getTime()-c);c=(new Date).getTime();F();console.log("draw viewport",
(new Date).getTime()-c);c=(new Date).getTime();d();console.log("draw contextmenus",(new Date).getTime()-c);console.log("draw complete, total time\x3d",(new Date).getTime()-b);a.onLoadingStop()};this.draw();q();this.attachPoint=b;this.reports=c;this.DAG=t;this.DAGMinimap=H;this.DAGHistory=A;this.DAGTooltip=B;this.DAGContextMenu=E;this.graph=y;this.resetViewport=q;this.history=v;a.export.png&&document.getElementById(a.export.png).addEventListener("click",function(){k("graph.png")});a.export.svg&&document.getElementById(a.export.svg).addEventListener("click",
function(){m("graph.svg")});a.export.json&&document.getElementById(a.export.json).addEventListener("click",function(){a.onLoadingStart();var b="data:text/plain;charset\x3dutf-8,"+encodeURIComponent(JSON.stringify(c));g(b,"graph.json");a.onLoadingStop()})}var Node=function(b){this.id=b;this.hidden=this.never_visible=!1;this.child_nodes={};this.parent_nodes={}};Node.prototype.visible=function(b){if(0==arguments.length)return!this.never_visible&&!this.hidden;this.hidden=!b;return this};
Node.prototype.addChild=function(b){this.child_nodes[b.id]=b};Node.prototype.addParent=function(b){this.parent_nodes[b.id]=b};Node.prototype.removeChild=function(b){b.id in this.child_nodes&&delete this.child_nodes[b.id]};Node.prototype.removeParent=function(b){b.id in this.parent_nodes&&delete this.parent_nodes[b.id]};Node.prototype.getParents=function(){return values(this.parent_nodes)};Node.prototype.getChildren=function(){return values(this.child_nodes)};
Node.prototype.getVisibleParents=function(){var b={},c=function(a){if(!b[a.id]){b[a.id]={};var d=a.parent_nodes,e;for(e in d){var f=d[e];if(f.visible())b[a.id][e]=f;else{c(f);f=b[e];for(var g in f)b[a.id][g]=f[g]}}}};c(this);return values(b[this.id])};Node.prototype.getVisibleChildren=function(){var b={},c=function(a){if(!b[a.id]){b[a.id]={};var d=a.child_nodes,e;for(e in d){var f=d[e];if(f.visible())b[a.id][e]=f;else{c(f);f=b[e];for(var g in f)b[a.id][g]=f[g]}}}};c(this);return values(b[this.id])};
var Graph=function(){this.nodelist=[];this.nodes={}};Graph.prototype.addNode=function(b){this.nodelist.push(b);this.nodes[b.id]=b};Graph.prototype.getNode=function(b){return this.nodes[b]};Graph.prototype.getNodes=function(){return this.nodelist};Graph.prototype.getVisibleNodes=function(){return this.nodelist.filter(function(b){return b.visible()})};
Graph.prototype.getVisibleLinks=function(){for(var b={},c=function(a){if(!b[a.id]){b[a.id]={};var d=a.parent_nodes,e;for(e in d){var f=d[e];if(f.visible())b[a.id][e]=!0;else{c(f);f=b[e];for(var g in f)b[a.id][g]=!0}}}},a=0;a<this.nodelist.length;a++)c(this.nodelist[a]);var d=this.nodes,e=[],f=this.getVisibleNodes();for(a=0;a<f.length;a++){var g=f[a];Object.keys(b[g.id]).forEach(function(a){e.push({source:d[a],target:g})})}return e};
function getNodesBetween(b,c){var a={},d=[b,c],e=function(b){null==a[b.id]&&(b==c?(d.push(b),a[b.id]=!0):-1!=b.getParents().map(e).indexOf(!0)?(d.push(b),a[b.id]=!0):a[b.id]=!1);return a[b.id]};e(b);return d}
function getEntirePathNodes(b){var c={},a={},d={},e=function(a){if(!c[a.id]){c[a.id]={};d[a.id]=a;var b=a.parent_nodes,f;for(f in b){var g=b[f];if(g.visible())c[a.id][f]=!0,e(g);else{e(g);g=c[f];for(var p in g)c[a.id][p]=!0}}}},f=function(b){if(!a[b.id]){a[b.id]={};d[b.id]=b;var c=b.child_nodes,e;for(e in c){var g=c[e];if(g.visible())a[b.id][e]=!0,f(g);else{f(g);g=a[e];for(var p in g)a[b.id][p]=!0}}}};e(b);f(b);return values(d)}
function getEntirePathLinks(b){var c={},a={},d={},e=function(a){if(!c[a.id]){c[a.id]={};d[a.id]=a;var b=a.parent_nodes,f;for(f in b){var g=b[f];if(g.visible())c[a.id][f]=!0,e(g);else{e(g);g=c[f];for(var k in g)c[a.id][k]=!0}}}},f=function(b){if(!a[b.id]){a[b.id]={};d[b.id]=b;var c=b.child_nodes,e;for(e in c){var g=c[e];if(g.visible())a[b.id][e]=!0,f(g);else{f(g);g=a[e];for(var k in g)a[b.id][k]=!0}}}};e(b);f(b);b=[];for(var g in c){var m=d[g],k=c[g],n;for(n in k)k=d[n],b.push({source:k,target:m})}for(n in a)for(g in k=
d[n],m=a[n],m)m=d[g],b.push({source:k,target:m});return b}function values(b){return Object.keys(b).map(function(c){return b[c]})}function flatten(b){var c=[];return c.concat.apply(c,b)}
var DirectedAcyclicGraphHistory=function(){var b=History();b.addSelection=function(c,a){if(0!=c.length){var d={apply:function(){c.forEach(function(a){a.visible(!1)})},unapply:function(){c.forEach(function(a){a.visible(!0)})}};d.names=a;d.selection=c;return b.add(d)}};return b},History=function(){var b=0,c=[];c.add=function(a){a.id=b++;c.push(a);a.apply();return a};c.remove=function(a){var b=c.indexOf(a);-1!=b&&c.splice(b,1);a.unapply();for(b=0;b<c.length;b++)c[b].apply();return a};return c};
function List(b){function c(c){c.each(function(c){var l=d3.select(this).selectAll("svg").data([c]),q=l.enter().append("svg");q.append("rect").attr("class","background").attr("width","100%").attr("height","100%");q.append("text").text("Hidden nodes").attr("text-anchor","middle").attr("x","50%").attr("dy","1.25em");q.append("svg").attr("class","list").attr("y",30);l.attr("width",a.call(this,c));l.attr("height",d.call(this,c));l.attr("x",e.call(this,c));l.attr("y",f.call(this,c));var r=l.select(".list").selectAll(".item").data(c,
function(a){return a.id});c=r.enter().insert("svg",":first-child").attr("class","item").attr("opacity",1e-8).attr("width",g).attr("height",m).attr("x",k).attr("y",n);c.each(p);r.transition().delay(b.animationDuration).duration(b.animationDuration).attr("x",k).attr("y",n);c.transition().delay(b.animationDuration).duration(b.animationDuration).attr("opacity",1);r.exit().transition().each("end",function(){0==r[0].length&&l.transition().duration(b.animationDuration).attr("opacity",.000001).remove()}).duration(b.animationDuration).attr("opacity",
.000001).remove()})}var a=constant(100),d=constant(100),e=constant(0),f=constant(0),g=constant("90%"),m=function(a){return 35+15*a.names.length},k=constant("5%"),n=function(a,b){var c=0;d3.select(this.parentNode).each(function(a){for(var d=0;d<b;d++)c+=m(a[d])+5});return c},p=function(a,b){var c=d3.select(this);c.append("rect").attr("x","1%").attr("y","1%").attr("width","98%").attr("height","98%").attr("rx","15").attr("ry","15");if(a.selection){b=a.selection.length;var d=b+" nodes:";1==b&&(d=b+" node:");
c.append("text").text(d).attr("x","50%").attr("dy","1em")}if(a.names.length)for(name in b=2,a.names)c.append("text").text(a.names[name]).attr("x","50%").attr("dy",b+"em"),b++},q=function(a,b){a=this.getBoundingClientRect();return{x:a.left,y:a.top,width:a.right-a.left,height:a.bottom-a.top}};c.select=function(a){return d3.select(this).selectAll(".item").data([a],function(a){return a.id}).node()};c.width=function(b){if(!arguments.length)return a;a=constant(b);return c};c.height=function(a){if(!arguments.length)return d;
d=constant(a);return c};c.x=function(a){if(!arguments.length)return e;e=constant(a);return c};c.y=function(a){if(!arguments.length)return f;f=constant(a);return c};c.itemwidth=function(a){if(!arguments.length)return g;g=constant(a);return c};c.itemheight=function(a){if(!arguments.length)return m;m=constant(a);return c};c.itemx=function(a){if(!arguments.length)return k;k=constant(a);return c};c.itemy=function(a){if(!arguments.length)return n;n=constant(a);return c};c.bbox=function(a){if(!arguments.length)return q;
q=constant(a);return c};return c}
function DirectedAcyclicGraphMinimap(b,c){return Minimap(c).draw(function(a){var c=d3.select(a).selectAll(".edge.visible").data();a=d3.select(a).selectAll(".node.visible").data();c=d3.select(this).selectAll(".edge").data(c);c.enter().append("path").attr("class","edge");c.exit().remove();a=d3.select(this).selectAll(".node").data(a);a.enter().append("g").attr("class","node").append("rect");a.selectAll("rect").attr("x",function(a){return-(a.bbox.width/2)}).attr("y",function(a){return-(a.bbox.height/2)}).attr("width",
function(a){return a.width}).attr("height",function(a){return a.height});a.exit().remove();a.attr("transform",b.nodeTranslate);c.attr("d",b.splineGenerator)})}
function Minimap(b){function c(b){b.each(function(b){var c=d3.select(this).selectAll("svg").data([b]),k=c.enter().append("svg");k.append("rect").attr("class","background").attr("width","100%").attr("height","100%");k=k.append("svg").attr("class","minimap");k.append("g").attr("class","contents");k.append("rect").attr("class","viewfinder");c.attr("width",a.call(this,b));c.attr("height",d.call(this,b));c.attr("x",e.call(this,b));c.attr("y",f.call(this,b));g.call(c.select(".contents").node(),b);var m=
c.select(".contents").node().getBBox();b=m.x-50;var l=m.y-50,r=m.width+100;m=m.height+100;c.select(".minimap").attr("viewBox",b+" "+l+" "+r+" "+m);k.select(".viewfinder").attr("x",b).attr("y",l).attr("width",r).attr("height",m)})}var a=constant(100),d=constant(100),e=constant(0),f=constant(0),g=function(a){var b=this;d3.selectAll(d3.select(a).select("svg").node().childNodes).each(function(a){b.appendChild(this.cloneNode(!0))})};c.draw=function(a){if(!arguments.length)return g;g=a;return c};c.width=
function(b){if(!arguments.length)return a;a=constant(b);return c};c.height=function(a){if(!arguments.length)return d;d=constant(a);return c};c.x=function(a){if(!arguments.length)return e;e=constant(a);return c};c.y=function(a){if(!arguments.length)return f;f=constant(a);return c};return c}
function MinimapZoom(){function b(b,c){b.call(a).on("dblclick.zoom",null);c.call(d)}var c=null,a=d3.behavior.zoom().on("zoom",function(){b.scale(d3.event.scale).translate(d3.event.translate);c&&c()}),d=d3.behavior.zoom().on("zoom",function(){var a=d3.mouse(d3.select(this).select(".minimap").node()),d=d3.select(this).select(".viewfinder").node().getBBox(),g=d?d.width:0,m=d?d.height:0;d=b.scale();g=d*(g/2-a[0]);a=d*(m/2-a[1]);d3.event.scale=d;d3.event.translate=[g,a];b.translate(d3.event.translate);
c&&c()}).scaleExtent([1,1]);b.translate=function(c){if(!arguments.length)return a.translate();a.translate(c);d.translate([0,0]);return b};b.scale=function(c){if(!arguments.length)return a.scale();a.scale(c);d.scale(1);return b};b.scaleExtent=function(c){if(!arguments.length)return a.scaleExtent();a.scaleExtent(c);return b};b.on=function(a,d){if("zoom"!=a)return b;if(null==d)return c;c=d;return b};b.getTransform=function(a){var c=(a.x+a.width/2-b.translate()[0])/b.scale();a=(a.y+a.height/2-b.translate()[1])/
b.scale();var d=.5/b.scale();return"translate("+c+","+a+") scale("+d+")"};return b}
var Selectable=function(){var b=function(b){var d=null;b.on("click",function(e){var f=d3.select(this),m=!f.classed("selected");d3.event.ctrlKey&&d3.event.shiftKey?m?(d=d||e,c.call(this,e,d).classed("selected",!0)):(f.classed("selected",m),d=d==e?null:d):d3.event.ctrlKey?(f.classed("selected",m),m?d=e:d==e&&(d=null)):d3.event.shiftKey?(b.classed("selected",!1),d=d||e,c.call(this,e,d).classed("selected",!0)):1==b.filter(".selected")[0].length?(b.classed("selected",!1),f.classed("selected",m),d=m?e:
null):(b.classed("selected",!1),f.classed("selected",!0),d=e);a()});d3.select("body").on("keyup",function(c){d3.event.ctrlKey&&65==d3.event.keyCode&&(c=b.filter(function(a){return!d3.select(this).classed("selected")}).empty(),b.classed("selected",!c),a())})},c=function(a,b){return[a,b]},a=function(){};b.getrange=function(a){if(0==arguments.length)return c;c=a;return b};b.on=function(c,e){if("select"==c){if(null==e)return a;a=e;return b}};return b};jQuery.fn.outerHTML=function(){return jQuery("\x3cdiv /\x3e").append(this.eq(0).clone()).html()};
var DirectedAcyclicGraphTooltip=function(b){return Tooltip(b).title(function(c){function a(a,b,c){a=$("\x3cdiv\x3e").attr("class","key").append(a);b=$("\x3cdiv\x3e").attr("class","value").append(b);var d=$("\x3cdiv\x3e").attr("class","clear");c.append($("\x3cdiv\x3e").append(a).append(b).append(d))}c=c.details;var d=$("\x3cdiv\x3e").attr("class","enricher-tooltip");a("ID",c.id,d);a("Name",c.name,d);a("Namespace",c.namespace,d);a("Definition",c.def.defstr,d);for(var e in b.tooltipFields)a(e,b.tooltipFields[e](c),
d);return d.outerHTML()})},Tooltip=function(b){var c=function(c){c.each(function(c){$(this).tipsy({gravity:b.tooltipGravity,html:!0,title:function(){return a(c)},opacity:1})})},a=function(a){return""};c.hide=function(){$(".tipsy").remove()};c.title=function(b){if(0==arguments.length)return a;a=b;return c};return c};window.width=function(){return document.body.clientWidth};window.height=function(){return document.body.clientHeight};function constant(b){return function(){return b}}
var getParameter=function(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");b=(new RegExp("[\\?\x26]"+b+"\x3d([^\x26#]*)")).exec(window.location.href);return null==b?"":b[1]},createGraphFromJSON=function(b,c){var a={},d;for(d in b.nodes)if(void 0==c.namespace||c.namespace==b.nodes[d].namespace)a[d]=new Node(d),a[d].details=b.nodes[d];for(var e in b.nodes){c=b.nodes[e];for(var f in c.parents)parentid=c.parents[f],a[parentid]&&a[e]&&(a[parentid].addChild(a[e]),a[e].addParent(a[parentid]))}b=new Graph;
for(var g in a)b.addNode(a[g]);return b},createJSONFromVisibleGraph=function(b){b=b.getVisibleNodes();for(var c=[],a=0;a<b.length;a++){var d=b[a],e=d.getVisibleParents();d=$.extend({},d.report);d.Edge=[];for(var f=0;f<e.length;f++)d.Edge.push(e[f].id);c.push(d)}return{reports:c}};
